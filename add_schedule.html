<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Agendar Evento</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
  <div class="card shadow">
    <div class="card-header bg-primary text-white">
      <h4 class="mb-0">Adicionar Agendamento</h4>
    </div>
    <div class="card-body">
      <form id="scheduleForm">
        <div class="row g-3">
          <div class="col-md-4">
            <label for="date" class="form-label">Data</label>
            <input type="date" class="form-control" id="date" required>
          </div>
          <div class="col-md-4">
            <label for="text" class="form-label">Hora</label>
            <input type="text" class="form-control" id="time" required>
          </div>
          <div class="col-md-4">
            <label for="id_myevent" class="form-label">Evento</label>
            <input type="number" class="form-control" id="id_myevent" required>
          </div>
          <div class="col-md-4">
            <label for="id_tpEvent" class="form-label">Tipo</label>
            <input type="number" class="form-control" id="id_tpEvent" required>
          </div>
          <div class="col-md-4">
            <label for="vacancies" class="form-label">Vagas</label>
            <input type="number" class="form-control" id="vacancies" required>
          </div>
        </div>

        <div class="mt-4">
          <button type="submit" class="btn btn-success">Agendar</button>
        </div>
      </form>

      <div id="result" class="mt-3"></div>
    </div>
  </div>
</div>

<script>
  document.getElementById("scheduleForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const payload = {
        table: "schedule",
        values: {
          date: document.getElementById("date").value,
          time: document.getElementById("time").value,
          id_myevent: parseInt(document.getElementById("id_myevent").value),
          id_tpEvent: parseInt(document.getElementById("id_tpEvent").value),
          vacancies: parseInt(document.getElementById("vacancies").value)
        }
      };

    
    try {
      const response = await fetch("http://localhost:8000/api/generic/create.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await response.json();

      const result = document.getElementById("result");
      if (response.ok) {
        result.innerHTML = `<div class="alert alert-success">Agendamento criado com sucesso!</div>`;
        console.log(payload)
      } else {
        result.innerHTML = `<div class="alert alert-danger">Erro: ${data.error}</div>`;
      }
    } catch (err) {
      document.getElementById("result").innerHTML = `<div class="alert alert-danger">Erro: ${err.message}</div>`;
    }
  });
</script>

</body>
</html>
